<?xml version="1.0" encoding="UTF-8"?>
<robot generated="20161205 22:19:38.851" generator="Robot 3.0 (Python 2.7.12 on linux2)">
<suite source="/home/fspcibld/openbmc-test-automation/extended/code_update/update_bmc.robot" id="s1" name="Update Bmc">
<test id="s1-t1" name="Initiate Code update BMC">
<kw name="Check If File Exist" library="code_update_utils">
<arguments>
<arg>${FILE_PATH}</arg>
</arguments>
<kw name="Log" library="BuiltIn">
<doc>Logs the given message with the given level.</doc>
<arguments>
<arg>\n PATH: ${filepath}</arg>
</arguments>
<msg timestamp="20161205 22:19:39.230" level="INFO">
PATH: /home/fspcibld/barreleye-20161205220222.all.tar</msg>
<status status="PASS" endtime="20161205 22:19:39.230" starttime="20161205 22:19:39.229"></status>
</kw>
<kw name="File Should Exist" library="OperatingSystem">
<doc>Fails unless the given ``path`` points to an existing file.</doc>
<arguments>
<arg>${filepath}</arg>
<arg>msg=${filepath} doesn't exist [ ERROR ]</arg>
</arguments>
<msg timestamp="20161205 22:19:39.230" html="yes" level="INFO">File '&lt;a href="file:///home/fspcibld/barreleye-20161205220222.all.tar"&gt;/home/fspcibld/barreleye-20161205220222.all.tar&lt;/a&gt;' exists.</msg>
<status status="PASS" endtime="20161205 22:19:39.230" starttime="20161205 22:19:39.230"></status>
</kw>
<kw name="Set Global Variable" library="BuiltIn">
<doc>Makes a variable available globally in all tests and suites.</doc>
<arguments>
<arg>${FILE_PATH}</arg>
<arg>${filepath}</arg>
</arguments>
<msg timestamp="20161205 22:19:39.231" level="INFO">${FILE_PATH} = /home/fspcibld/barreleye-20161205220222.all.tar</msg>
<status status="PASS" endtime="20161205 22:19:39.231" starttime="20161205 22:19:39.230"></status>
</kw>
<status status="PASS" endtime="20161205 22:19:39.231" starttime="20161205 22:19:39.229"></status>
</kw>
<kw name="System Readiness Test" library="code_update_utils">
<kw name="Run Keyword And Return Status" library="BuiltIn">
<doc>Runs the given keyword with given arguments and returns the status as a Boolean value.</doc>
<arguments>
<arg>Verify Ping and REST Authentication</arg>
</arguments>
<assign>
<var>${l_status}</var>
</assign>
<kw name="Verify Ping and REST Authentication" library="utils">
<kw name="Run Keyword And Return Status" library="BuiltIn">
<doc>Runs the given keyword with given arguments and returns the status as a Boolean value.</doc>
<arguments>
<arg>Ping Host</arg>
<arg>${OPENBMC_HOST}</arg>
</arguments>
<assign>
<var>${l_ping}</var>
</assign>
<kw name="Ping Host" library="utils">
<arguments>
<arg>${OPENBMC_HOST}</arg>
</arguments>
<kw name="Should Not Be Empty" library="BuiltIn">
<doc>Verifies that the given item is not empty.</doc>
<arguments>
<arg>${host}</arg>
<arg>msg=No host provided</arg>
</arguments>
<msg timestamp="20161205 22:19:39.233" level="INFO">Length is 10</msg>
<status status="PASS" endtime="20161205 22:19:39.233" starttime="20161205 22:19:39.233"></status>
</kw>
<kw name="Run And Return Rc And Output" library="OperatingSystem">
<doc>Runs the given command in the system and returns the RC and output.</doc>
<arguments>
<arg>ping -c 4 ${host}</arg>
</arguments>
<assign>
<var>${RC}</var>
<var>${output}</var>
</assign>
<msg timestamp="20161205 22:19:39.237" level="INFO">Running command 'ping -c 4 9.3.29.119 2&gt;&amp;1'.</msg>
<msg timestamp="20161205 22:19:42.243" level="INFO">${RC} = 0</msg>
<msg timestamp="20161205 22:19:42.243" level="INFO">${output} = PING 9.3.29.119 (9.3.29.119) 56(84) bytes of data.
64 bytes from 9.3.29.119: icmp_seq=1 ttl=62 time=1.29 ms
64 bytes from 9.3.29.119: icmp_seq=2 ttl=62 time=0.794 ms
64 bytes from 9.3.29.119: icmp_seq...</msg>
<status status="PASS" endtime="20161205 22:19:42.244" starttime="20161205 22:19:39.233"></status>
</kw>
<kw name="Log" library="BuiltIn">
<doc>Logs the given message with the given level.</doc>
<arguments>
<arg>RC: ${RC}\nOutput:\n${output}</arg>
</arguments>
<msg timestamp="20161205 22:19:42.247" level="INFO">RC: 0
Output:
PING 9.3.29.119 (9.3.29.119) 56(84) bytes of data.
64 bytes from 9.3.29.119: icmp_seq=1 ttl=62 time=1.29 ms
64 bytes from 9.3.29.119: icmp_seq=2 ttl=62 time=0.794 ms
64 bytes from 9.3.29.119: icmp_seq=3 ttl=62 time=0.789 ms
64 bytes from 9.3.29.119: icmp_seq=4 ttl=62 time=0.770 ms

--- 9.3.29.119 ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3001ms
rtt min/avg/max/mdev = 0.770/0.911/1.293/0.222 ms</msg>
<status status="PASS" endtime="20161205 22:19:42.247" starttime="20161205 22:19:42.246"></status>
</kw>
<kw name="Should Be Equal" library="BuiltIn">
<doc>Fails if the given objects are unequal.</doc>
<arguments>
<arg>${RC}</arg>
<arg>${0}</arg>
</arguments>
<status status="PASS" endtime="20161205 22:19:42.248" starttime="20161205 22:19:42.248"></status>
</kw>
<status status="PASS" endtime="20161205 22:19:42.249" starttime="20161205 22:19:39.233"></status>
</kw>
<msg timestamp="20161205 22:19:42.249" level="INFO">${l_ping} = True</msg>
<status status="PASS" endtime="20161205 22:19:42.249" starttime="20161205 22:19:39.232"></status>
</kw>
<kw name="Run Keyword If" library="BuiltIn">
<doc>Runs the given keyword with the given arguments, if ``condition`` is true.</doc>
<arguments>
<arg>'${l_ping}' == '${False}'</arg>
<arg>Fail</arg>
<arg>msg=Ping Failed</arg>
</arguments>
<status status="PASS" endtime="20161205 22:19:42.254" starttime="20161205 22:19:42.250"></status>
</kw>
<kw name="Run Keyword And Return Status" library="BuiltIn">
<doc>Runs the given keyword with given arguments and returns the status as a Boolean value.</doc>
<arguments>
<arg>Initialize OpenBMC</arg>
</arguments>
<assign>
<var>${l_rest}</var>
</assign>
<kw name="Initialize OpenBMC" library="rest_client">
<kw name="Create Session" library="RequestsLibrary.RequestsKeywords">
<doc>Create Session: create a HTTP session to a server</doc>
<arguments>
<arg>openbmc</arg>
<arg>${AUTH_URI}</arg>
<arg>timeout=${timeout}</arg>
<arg>max_retries=3</arg>
</arguments>
<msg timestamp="20161205 22:19:42.257" level="INFO">Creating Session using : alias=openbmc, url=https://9.3.29.119, headers={},                     cookies=None, auth=None, timeout=10, proxies=None, verify=False,                     debug=0 </msg>
<status status="PASS" endtime="20161205 22:19:42.258" starttime="20161205 22:19:42.256"></status>
</kw>
<kw name="Create Dictionary" library="BuiltIn">
<doc>Creates and returns a dictionary based on given items.</doc>
<arguments>
<arg>Content-Type=application/json</arg>
</arguments>
<assign>
<var>${headers}</var>
</assign>
<msg timestamp="20161205 22:19:42.259" level="INFO">${headers} = {u'Content-Type': u'application/json'}</msg>
<status status="PASS" endtime="20161205 22:19:42.259" starttime="20161205 22:19:42.258"></status>
</kw>
<kw name="Create List" library="BuiltIn">
<doc>Returns a list containing given items.</doc>
<arguments>
<arg>${OPENBMC_USERNAME}</arg>
<arg>${OPENBMC_PASSWORD}</arg>
</arguments>
<assign>
<var>@{credentials}</var>
</assign>
<msg timestamp="20161205 22:19:42.259" level="INFO">@{credentials} = [ root | 0penBmc ]</msg>
<status status="PASS" endtime="20161205 22:19:42.259" starttime="20161205 22:19:42.259"></status>
</kw>
<kw name="Create Dictionary" library="BuiltIn">
<doc>Creates and returns a dictionary based on given items.</doc>
<arguments>
<arg>data=@{credentials}</arg>
</arguments>
<assign>
<var>${data}</var>
</assign>
<msg timestamp="20161205 22:19:42.260" level="INFO">${data} = {u'data': [u'root', u'0penBmc']}</msg>
<status status="PASS" endtime="20161205 22:19:42.260" starttime="20161205 22:19:42.260"></status>
</kw>
<kw name="Post Request" library="RequestsLibrary.RequestsKeywords">
<doc>Send a POST request on the session object found using the</doc>
<arguments>
<arg>openbmc</arg>
<arg>/login</arg>
<arg>data=${data}</arg>
<arg>headers=${headers}</arg>
</arguments>
<assign>
<var>${resp}</var>
</assign>
<msg timestamp="20161205 22:20:29.046" level="FAIL">ConnectionError: HTTPSConnectionPool(host='9.3.29.119', port=443): Max retries exceeded with url: /login (Caused by ReadTimeoutError("HTTPSConnectionPool(host='9.3.29.119', port=443): Read timed out. (read timeout=10.0)",))</msg>
<status status="FAIL" endtime="20161205 22:20:29.047" starttime="20161205 22:19:42.260"></status>
</kw>
<status status="FAIL" endtime="20161205 22:20:29.047" starttime="20161205 22:19:42.255"></status>
</kw>
<msg timestamp="20161205 22:20:29.047" level="INFO">${l_rest} = False</msg>
<status status="PASS" endtime="20161205 22:20:29.048" starttime="20161205 22:19:42.255"></status>
</kw>
<kw name="Run Keyword If" library="BuiltIn">
<doc>Runs the given keyword with the given arguments, if ``condition`` is true.</doc>
<arguments>
<arg>'${l_rest}' == '${False}'</arg>
<arg>Fail</arg>
<arg>msg=REST Authentication Failed</arg>
</arguments>
<kw name="Fail" library="BuiltIn">
<doc>Fails the test with the given message and optionally alters its tags.</doc>
<arguments>
<arg>msg=REST Authentication Failed</arg>
</arguments>
<msg timestamp="20161205 22:20:29.053" level="FAIL">REST Authentication Failed</msg>
<status status="FAIL" endtime="20161205 22:20:29.053" starttime="20161205 22:20:29.053"></status>
</kw>
<status status="FAIL" endtime="20161205 22:20:29.053" starttime="20161205 22:20:29.048"></status>
</kw>
<status status="FAIL" endtime="20161205 22:20:29.054" starttime="20161205 22:19:39.232"></status>
</kw>
<msg timestamp="20161205 22:20:29.054" level="INFO">${l_status} = False</msg>
<status status="PASS" endtime="20161205 22:20:29.054" starttime="20161205 22:19:39.232"></status>
</kw>
<kw name="Run Keyword If" library="BuiltIn">
<doc>Runs the given keyword with the given arguments, if ``condition`` is true.</doc>
<arguments>
<arg>'${l_status}' == '${False}'</arg>
<arg>Fail</arg>
<arg>msg=System not in ideal state to use [ERROR]</arg>
</arguments>
<kw name="Fail" library="BuiltIn">
<doc>Fails the test with the given message and optionally alters its tags.</doc>
<arguments>
<arg>msg=System not in ideal state to use [ERROR]</arg>
</arguments>
<msg timestamp="20161205 22:20:29.058" level="FAIL">System not in ideal state to use [ERROR]</msg>
<status status="FAIL" endtime="20161205 22:20:29.058" starttime="20161205 22:20:29.058"></status>
</kw>
<status status="FAIL" endtime="20161205 22:20:29.058" starttime="20161205 22:20:29.054"></status>
</kw>
<status status="FAIL" endtime="20161205 22:20:29.058" starttime="20161205 22:19:39.231"></status>
</kw>
<doc>BMC code update process initiation</doc>
<status status="FAIL" endtime="20161205 22:20:29.059" critical="yes" starttime="20161205 22:19:39.228">System not in ideal state to use [ERROR]</status>
</test>
<test id="s1-t2" name="Test BMC CPU Mem Performance at Ready State">
<kw name="Check BMC CPU Performance" library="utils">
<doc>Minimal 10% of proc should be free in 3 sample</doc>
<kw type="for" name="${var} IN RANGE [ 1 | 4 ]">
<kw type="foritem" name="${var} = 1">
<kw name="BMC CPU Performance Check" library="utils">
<doc>Minimal 10% of proc should be free in this instance</doc>
<kw name="Execute Command" library="SSHLibrary">
<doc>Executes `command` on the remote machine and returns its outputs.</doc>
<arguments>
<arg>${bmc_cpu_usage_cmd}</arg>
<arg>return_stderr=True</arg>
</arguments>
<assign>
<var>${bmc_cpu_usage_output}</var>
<var>${stderr}</var>
</assign>
<msg timestamp="20161205 22:20:29.061" level="INFO">Executing command 'top -n 1 | grep CPU: | cut -c 7-9'.</msg>
<msg timestamp="20161205 22:20:29.063" level="FAIL">No open connection.</msg>
<status status="FAIL" endtime="20161205 22:20:29.063" starttime="20161205 22:20:29.061"></status>
</kw>
<status status="FAIL" endtime="20161205 22:20:29.063" starttime="20161205 22:20:29.060"></status>
</kw>
<status status="FAIL" endtime="20161205 22:20:29.063" starttime="20161205 22:20:29.060"></status>
</kw>
<status status="FAIL" endtime="20161205 22:20:29.063" starttime="20161205 22:20:29.060"></status>
</kw>
<status status="FAIL" endtime="20161205 22:20:29.063" starttime="20161205 22:20:29.059"></status>
</kw>
<status status="FAIL" endtime="20161205 22:20:29.063" critical="yes" starttime="20161205 22:20:29.059">No open connection.</status>
</test>
<doc>Trigger code update to a target BMC.
Execution Method :
python -m robot -v OPENBMC_HOST:&lt;hostname&gt;
-v FILE_PATH:&lt;path/*all.tar&gt; update_bmc.robot

Code update method BMC using REST
Update work flow sequence:
- User input BMC File existence check
- Ping Test and REST authentication
- Set Host Power host setting Policy to RESTORE_LAST_STATE
On reboot this policy would ensure the BMC comes
online and stays at HOST_POWERED_OFF state.
- Issue poweroff
- Prepare for Update
- Wait for BMC to come online clean
- Wait for BMC_READY state
- Apply preserve BMC Network setting
- SCP image to BMC
- Activate the flash image
- Warm Reset BMC to activate code
- Wait for BMC to come online time out 30 minutes
- Version check post update</doc>
<status status="FAIL" endtime="20161205 22:20:29.064" starttime="20161205 22:19:38.853"></status>
</suite>
<statistics>
<total>
<stat fail="2" pass="0">Critical Tests</stat>
<stat fail="2" pass="0">All Tests</stat>
</total>
<tag>
</tag>
<suite>
<stat fail="2" id="s1" name="Update Bmc" pass="0">Update Bmc</stat>
</suite>
</statistics>
<errors>
</errors>
</robot>
